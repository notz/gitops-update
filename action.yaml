name: 'GitOps Update'
description: 'Updates a key in a gitops repository and commit it'
inputs:
  filename: 
    description: 'Filename to update'
    required: true
  key:  
    description: "The key to update. Key a string before the colon. Usually it's yaml key like `this-is-key: value`"
    required: true
  value:  
    description: "The value to set"
    required: true
  github-deploy-key:  
    description: "Github deploy ssh private key to clone and commit target repository"
    required: true
  github-repo:
    description: "Target repository"
    required: true
  github-org:
    description: "Target organization"
    required: true
  username:
    description: "The username of the github user"
    required: true
  email:
    description: "The email of the github user"
    required: true

runs:
  using: "composite"
  steps:
    - uses: actions/checkout@master
    - name: Golang
      uses: actions/setup-go@v2
      with:
        go-version: '1.16.8'
      env:
        GO111MODULE: on
    - name: Checkout code
      uses: actions/checkout@v2
      with:
        repository: simplycubed/gitops-update
    - run: go run main.go
      shell: bash
      env:
        FILE_NAME: ${{ inputs.filename }}
        KEY: ${{ inputs.key }}
        GITHUB_DEPLOY_KEY: ${{ inputs.github-deploy-key }}
        VALUE: ${{ inputs.value }}
        GITHUB_REPO_NAME: ${{ inputs.github-repo }}
        GITHUB_ORG_NAME: ${{ inputs.github-org }}
        USERNAME: ${{ inputs.username }}
        EMAIL: ${{ inputs.email }}
